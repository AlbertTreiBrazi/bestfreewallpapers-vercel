import React, { Suspense } from 'react'
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom'
import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
import { Toaster } from 'react-hot-toast'
import { AuthProvider } from '@/contexts/AuthContext'
import { ThemeProvider } from '@/contexts/ThemeContext'
import { Header } from '@/components/layout/Header'
import { Footer } from '@/components/layout/Footer'
import { PremiumBanner } from '@/components/premium/PremiumBanner'
import { ErrorBoundary } from '@/components/ui/ErrorBoundary'
import { PageLoadingSkeleton } from '@/components/ui/LoadingSkeleton'
import { initializePerformanceOptimizations } from '@/utils/performance-optimization'
import './App.css'

// Initialize performance optimizations
initializePerformanceOptimizations()

// Lazy load all page components for better performance
const HomePage = React.lazy(() => import('@/pages/HomePage'))
const WallpapersPage = React.lazy(() => import('@/pages/WallpapersPage'))
const FreeWallpapersPage = React.lazy(() => import('@/pages/FreeWallpapersPage'))
const MobileWallpapersPage = React.lazy(() => import('@/pages/MobileWallpapersPage'))
const AIWallpapersPage = React.lazy(() => import('@/pages/AIWallpapersPage'))
const DeviceCollectionPage = React.lazy(() => import('@/pages/DeviceCollectionPage'))
const CategoryPage = React.lazy(() => import('@/pages/CategoryPage'))
const ContactPage = React.lazy(() => import('@/pages/ContactPage'))
const PremiumPage = React.lazy(() => import('@/pages/PremiumPage'))
const AdminPage = React.lazy(() => import('@/pages/AdminPage'))
const FavoritesPage = React.lazy(() => import('@/pages/FavoritesPage'))
const AboutPage = React.lazy(() => import('@/pages/AboutPage'))
const CategoriesPage = React.lazy(() => import('@/pages/CategoriesPage'))
const CollectionsPage = React.lazy(() => import('@/pages/CollectionsPage'))
const CollectionDetailPage = React.lazy(() => import('@/pages/CollectionDetailPage'))
const WallpaperDetailPage = React.lazy(() => import('@/pages/WallpaperDetailPage'))
const PrivacyPage = React.lazy(() => import('@/pages/PrivacyPage'))
const TermsPage = React.lazy(() => import('@/pages/TermsPage'))
const CookiePage = React.lazy(() => import('@/pages/CookiePage'))
const DMCAPage = React.lazy(() => import('@/pages/DMCAPage'))
const GuidelinesPage = React.lazy(() => import('@/pages/GuidelinesPage'))
const HelpPage = React.lazy(() => import('@/pages/HelpPage'))
const APIPage = React.lazy(() => import('@/pages/APIPage'))
const ResetPasswordPage = React.lazy(() => import('@/pages/ResetPasswordPage'))
const EnhancedSearchPage = React.lazy(() => import('@/pages/EnhancedSearchPage'))
const ErrorPage = React.lazy(() => import('@/pages/ErrorPage'))
const MobilePage = React.lazy(() => import('@/pages/MobilePage'))
const SizesPage = React.lazy(() => import('@/pages/SizesPage'))
const LicensePage = React.lazy(() => import('@/pages/LicensePage'))
const AuthPage = React.lazy(() => import('@/pages/AuthPage'))
const AuthCallbackPage = React.lazy(() => import('@/pages/AuthCallbackPage'))

// Create a stable QueryClient instance
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000, // 5 minutes
      gcTime: 10 * 60 * 1000, // 10 minutes
      retry: 2,
      refetchOnWindowFocus: false,
    },
  },
})

function App() {
  return (
    <ErrorBoundary>
      <QueryClientProvider client={queryClient}>
        <ThemeProvider>
          <AuthProvider>
            <Router>
              <div className="min-h-screen bg-background text-foreground">
                <Header />
                <PremiumBanner />
                <main className="flex-1">
                  <Suspense fallback={<PageLoadingSkeleton />}>
                    <Routes>
                      {/* Main Pages */}
                      <Route path="/" element={<HomePage />} />
                      <Route path="/wallpapers" element={<WallpapersPage />} />
                      <Route path="/free-wallpapers" element={<FreeWallpapersPage />} />
                      <Route path="/mobile-wallpapers" element={<MobileWallpapersPage />} />
                      <Route path="/ai-wallpapers" element={<AIWallpapersPage />} />
                      <Route path="/wallpaper/:slug" element={<WallpaperDetailPage />} />
                      <Route path="/categories" element={<CategoriesPage />} />
                      <Route path="/category/:slug" element={<CategoryPage />} />
                      <Route path="/collections" element={<CollectionsPage />} />
                      <Route path="/collections/iphone-wallpapers" element={<DeviceCollectionPage />} />
                      <Route path="/collections/android-wallpapers" element={<DeviceCollectionPage />} />
                      <Route path="/collections/samsung-galaxy-wallpapers" element={<DeviceCollectionPage />} />
                      <Route path="/collections/ipad-wallpapers" element={<DeviceCollectionPage />} />
                      <Route path="/collections/oneplus-wallpapers" element={<DeviceCollectionPage />} />
                      <Route path="/collections/xiaomi-wallpapers" element={<DeviceCollectionPage />} />
                      <Route path="/collections/:slug" element={<CollectionDetailPage />} />
                      <Route path="/favorites" element={<FavoritesPage />} />
                      <Route path="/search" element={<EnhancedSearchPage />} />
                      
                      {/* User Pages */}
                      <Route path="/premium" element={<PremiumPage />} />
                      <Route path="/contact" element={<ContactPage />} />
                      <Route path="/about" element={<AboutPage />} />
                      <Route path="/mobile" element={<MobilePage />} />
                      <Route path="/sizes" element={<SizesPage />} />
                      <Route path="/license" element={<LicensePage />} />
                      
                      {/* Legal Pages */}
                      <Route path="/privacy" element={<PrivacyPage />} />
                      <Route path="/terms" element={<TermsPage />} />
                      <Route path="/cookie-policy" element={<CookiePage />} />
                      <Route path="/dmca" element={<DMCAPage />} />
                      <Route path="/guidelines" element={<GuidelinesPage />} />
                      <Route path="/help" element={<HelpPage />} />
                      <Route path="/api" element={<APIPage />} />
                      
                      {/* Auth Pages */}
                      <Route path="/auth" element={<AuthPage />} />
                      <Route path="/auth/callback" element={<AuthCallbackPage />} />
                      <Route path="/reset-password" element={<ResetPasswordPage />} />
                      
                      {/* Admin Pages */}
                      <Route path="/admin" element={<AdminPage />} />
                      
                      {/* Error Pages */}
                      <Route path="/404" element={<ErrorPage />} />
                      
                      {/* Redirects */}
                      <Route path="*" element={<Navigate to="/404" replace />} />
                    </Routes>
                  </Suspense>
                </main>
                <Footer />
              </div>
              <Toaster
                position="top-right"
                toastOptions={{
                  duration: 4000,
                  style: {
                    background: 'var(--background)',
                    color: 'var(--foreground)',
                    border: '1px solid var(--border)',
                  },
                }}
              />
            </Router>
          </AuthProvider>
        </ThemeProvider>
      </QueryClientProvider>
    </ErrorBoundary>
  )
}

export default App